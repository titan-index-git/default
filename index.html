<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Titan Index ‚Äî September 2025</title>
  <meta name="description" content="Titan Index ‚Äî objective, monthly macro trends"/>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text x='50' y='60' text-anchor='middle' font-size='60'>üõ°Ô∏è</text></svg>">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{--ok:#16a34a; --bad:#dc2626; --warn:#d97706; --muted:#6b7280; --card:#111827; --bg:#0b1020; --ink:#e5e7eb}
    *{box-sizing:border-box}
    html,body{margin:0; padding:0; background:var(--bg); color:var(--ink); font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    .wrap{max-width:1100px; margin:0 auto; padding:16px}
    .header h1{margin:0 0 8px 0; font-weight:800; letter-spacing:.5px}
    .header .meta{opacity:.8; font-size:14px}
    .controls{display:flex; gap:8px; align-items:center; padding:8px 0; position:sticky; top:0; background:linear-gradient(180deg, rgba(11,16,32,.95), rgba(11,16,32,.75)); backdrop-filter: blur(6px); z-index:10}
    .controls select,.controls button{background:#0f172a; color:var(--ink); border:1px solid #1f2937; padding:8px 10px; border-radius:10px}
    .grid{display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); gap:14px; margin-top:12px}
    .card{background:var(--card); border:1px solid #1f2937; border-radius:16px; padding:14px; box-shadow:0 10px 40px rgba(0,0,0,.25)}
    .card h3{margin:0 0 6px 0; font-size:16px; font-weight:700}
    .kpi{display:flex; align-items:baseline; gap:10px; margin:4px 0}
    .kpi .value{font-size:28px; font-weight:800}
    .kpi .trend{font-size:14px; opacity:.9}
    .kpi .trend.up{color:var(--ok)} .kpi .trend.down{color:var(--bad)} .kpi .trend.flat{color:var(--warn)}
    .badge{display:inline-flex; gap:6px; align-items:center; font-size:12px; padding:4px 8px; border-radius:999px; border:1px solid #334155; background:#0b1225; color:#cbd5e1}
    .footer{opacity:.8; font-size:12px}
    small.muted{color:var(--muted)}
    .list{margin-top:8px; font-size:12px; color:#cbd5e1}
    .list li{margin:4px 0}
  </style>
</head>
<body>
  <header class="wrap header">
    <h1>üõ°Ô∏è Titan Index</h1>
    <p id="mission">In the time of press and cultural polarization, an attempt at an objective measuring stick combining all key health indicators for everyone.</p>
    <div class="meta">
      <span id="asOf"></span>
      <span>‚Ä¢</span>
      <span id="monthChange"></span>
    </div>
  </header>

  <main class="wrap">
    <section id="controls" class="controls">
      <label for="monthSelect">Month:</label>
      <select id="monthSelect"></select>
      <button id="dlBtn" title="Download current month JSON">Export month JSON</button>
    </section>
    <section id="sections" class="grid"></section>
  </main>

  <footer class="wrap footer">
    <p>Built for <strong>Mike Szymecki</strong>. Last updated <span id="buildDate"></span>.</p>
  </footer>

  <!-- Embedded default data (Sept 2025). If /data/*.json exists, we load that instead. -->
  <script>
    window.TITAN_DATA = {
      "months":[{"label":"2025-09","file":"__embedded__"}],
      "embedded":{
        "meta":{
          "label":"September 2025",
          "mom_note":"Labor market softened (UR 4.3%); wage growth cooled to 3.7% YoY; mortgage rates eased to ~6.50%; NAR median price steady at $422,400."
        },
        "sections":[
          {
            "title":"Debt & Income","emoji":"üíµ",
            "items":[
              {"name":"Inflation (YoY CPI)","display":"2.7%","change":"0.0 pp","direction":"flat","good_when_up":false,
               "notes":["Data period: Jul 2025 (next CPI due Sep 11, 2025). Source: BLS CPI."]},
              {"name":"Unemployment","display":"4.3%","change":"+0.1 pp","direction":"up","good_when_up":false,
               "notes":["Data period: Aug 2025. Source: BLS Employment Situation."]},
              {"name":"Average Hourly Earnings","display":"+3.7% YoY","change":"-0.2 pp","direction":"down","good_when_up":true,
               "notes":["Data period: Aug 2025. Source: BLS Employment Situation."]}
            ]
          },
          {
            "title":"Housing","emoji":"üè†",
            "items":[
              {"name":"30y Mortgage Rate","display":"6.50%","change":"-0.06 pp","direction":"down","good_when_up":false,
               "notes":["Week ending Sep 4, 2025. Source: Freddie Mac PMMS."]},
              {"name":"Median Existing-Home Price","display":"$422,400","change":"0","direction":"flat","good_when_up":false,
               "notes":["Data period: Jul 2025; +0.2% YoY. Source: NAR."]}
            ]
          },
          {
            "title":"Markets","emoji":"üìà",
            "items":[
              {"name":"S&P 500 (SPY)","display":"648.44","change":"‚Äî","direction":"flat","good_when_up":true,
               "notes":["Level as of Sep 8, 2025 close ~= intraday."]},
              {"name":"BTC/USD","display":"$112,423","change":"‚Äî","direction":"flat","good_when_up":true,
               "notes":["Level as of Sep 8, 2025."]}
            ]
          }
        ]
      }
    };
  </script>

  <script>
    const monthSelect = document.getElementById('monthSelect');
    const sectionsEl = document.getElementById('sections');
    const asOfEl = document.getElementById('asOf');
    const monthChangeEl = document.getElementById('monthChange');
    const buildDateEl = document.getElementById('buildDate');
    const dlBtn = document.getElementById('dlBtn');
    buildDateEl.textContent = new Date(document.lastModified).toLocaleString();

    const trendClass = d => d==='up'?'up':(d==='down'?'down':'flat');
    const trendGlyph = d => d==='up'?'‚ñ≤':(d==='down'?'‚ñº':'‚ñ†');

    async function tryFetch(url){
      try{ const r = await fetch(url); if(!r.ok) throw 0; return await r.json(); }catch(_){ return null; }
    }

    function renderMonth(month){
      asOfEl.textContent = `As of ${month.meta.label}`;
      monthChangeEl.textContent = `${month.meta.mom_note||''}`.trim();
      sectionsEl.innerHTML = '';
      month.sections.forEach(sec=>{
        const card = document.createElement('article'); card.className='card';
        const h = document.createElement('h3'); h.textContent = `${sec.emoji} ${sec.title}`; card.appendChild(h);
        sec.items.forEach(it=>{
          const row = document.createElement('div'); row.className='kpi';
          const v = document.createElement('div'); v.className='value'; v.textContent = it.display;
          const t = document.createElement('div'); t.className=`trend ${trendClass(it.direction)}`; t.textContent = `${trendGlyph(it.direction)} ${it.change}`;
          const b = document.createElement('span'); b.className='badge'; b.innerText = `${it.name}`;
          row.appendChild(v); row.appendChild(t); row.appendChild(b); card.appendChild(row);
          if(it.notes && it.notes.length){ const ul=document.createElement('ul'); ul.className='list'; it.notes.forEach(n=>{ const li=document.createElement('li'); li.innerHTML=n; ul.appendChild(li);}); card.appendChild(ul); }
        });
        sectionsEl.appendChild(card);
      });
    }

    async function init(){
      // Try external data first (if you later add /data/index.json). Otherwise use embedded.
      let idx = await tryFetch('data/index.json');
      let month;
      if(idx && idx.months && idx.months.length){
        // Load last month file
        const last = idx.months[idx.months.length-1];
        let m = (last.file==='__embedded__') ? window.TITAN_DATA.embedded : await tryFetch('data/'+last.file);
        month = m || window.TITAN_DATA.embedded;
        idx = idx; // keep
      } else {
        // Fully embedded mode
        idx = { months: window.TITAN_DATA.months };
        month = window.TITAN_DATA.embedded;
      }

      // Populate dropdown (embedded only shows Sept by default)
      monthSelect.innerHTML = '';
      idx.months.forEach((m,i)=>{
        const opt = document.createElement('option');
        opt.value = m.file; opt.textContent = m.label;
        if(i===idx.months.length-1) opt.selected = true;
        monthSelect.appendChild(opt);
      });
      renderMonth(month);

      dlBtn.onclick = ()=>{
        const blob = new Blob([JSON.stringify(month, null, 2)], {type:'application/json'});
        const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = '2025-09.json'; a.click();
        URL.revokeObjectURL(a.href);
      };
      monthSelect.addEventListener('change', async e=>{
        if(e.target.value==='__embedded__'){ renderMonth(window.TITAN_DATA.embedded); }
        else {
          const m = await tryFetch('data/'+e.target.value);
          if(m) renderMonth(m);
        }
      });
    }
    init();
  </script>
</body>
</html>
